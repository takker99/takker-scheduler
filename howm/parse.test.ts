/// <reference lib="deno.ns" />

import { parse } from "./parse.ts";
import { assertSnapshot } from "../deps/testing.ts";

Deno.test("parse()", async (t) => {
  await t.step("compatibility", async (t) => {
    const args = [
      "â¬œã‚¿ã‚¹ã‚¯ãƒªãƒ³ã‚¯@2023-09-10",
      "âœ…çµ‚äº†ã—ãŸãƒªãƒ³ã‚¯@2023-09-10",
      "ðŸ“ã‚„ã‚Šé€”ä¸­ã®@2023-09-10ãƒªãƒ³ã‚¯",
      "å…ˆé ­ã«ãªã„çµµæ–‡å­—ã¯âœ…ã‚¿ã‚¹ã‚¯åˆ¤å®šã¨é–¢ä¿‚ãªã„@2023-09-10",
      "âœ…æ—¥ä»˜ãŒãªã„ã‚¿ã‚¹ã‚¯ã¯ã‚¿ã‚¹ã‚¯ã¨ã¿ãªã•ãªã„",
    ];
    for (const arg of args) {
      await t.step(arg, () => assertSnapshot(t, parse(arg)));
    }
  });
  {
    const arg = " å‰å¾Œã® ç©ºç™½ã¯ã€€@2023-09-11 ç„¡è¦–ã•ã‚Œã‚‹ã€€  ";
    await t.step(arg, () => assertSnapshot(t, parse(arg)));
  }
  await t.step("type", async (t) => {
    const args = [
      "!@2002-10-20 ãƒã‚¤ã‚¦ã‚§ã‚¤æƒ‘æ˜Ÿ ã€†åˆ‡",
      "ãƒã‚¤ã‚¦ã‚§ã‚¤æƒ‘æ˜Ÿ ã€†åˆ‡!4@2002-10-20",
      "-@2002-10-20 ãƒã‚¤ã‚¦ã‚§ã‚¤æƒ‘æ˜Ÿ è²·ãŠã†",
      "ãƒã‚¤ã‚¦ã‚§ã‚¤æƒ‘æ˜Ÿ è²·ãŠã†ã‹ãª~@2023-09-12",
      "ãƒã‚¤ã‚¦ã‚§ã‚¤æƒ‘æ˜Ÿ+@2002-10-20 è²·ãŠã†",
      "èª­æ›¸ä¼š@2023-04-11T13:00",
    ];
    for (const arg of args) {
      await t.step(arg, () => assertSnapshot(t, parse(arg)));
    }
  });
  await t.step("start datetime", async (t) => {
    const args = [
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04â€»ã‚¿ã‚¹ã‚¯æ‰±ã„ã•ã‚Œãªã„",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023â€»ã‚¿ã‚¹ã‚¯æ‰±ã„ã•ã‚Œãªã„",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30T12:23",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30T12:23:45 â€»ç§’ã¯ç„¡è¦–ã™ã‚‹",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30 12:23:â€»åŒºåˆ‡ã‚Šæ–‡å­—ãŒå¿…è¦",
    ];
    for (const arg of args) {
      await t.step(arg, () => assertSnapshot(t, parse(arg)));
    }
  });
  await t.step("end datetime", async (t) => {
    const args = [
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13/23D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13/05-23D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13/2024-05-23D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13/2024-05-23T05:47D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13/05-23T05:47D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13/23T05:47D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13/T05:47D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13/05:47D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13T13:40/23D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13T13:40/05-23D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13T13:40/2025-05-23D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13T13:40/2025-05-23T05:47D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13T13:40/05-23T05:47D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13T13:40/23T05:47D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13T13:40/T05:47D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13T13:40/14:47D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13D45/05:47",
    ];
    for (const arg of args) {
      await t.step(arg, () => assertSnapshot(t, parse(arg)));
    }
  });
  await t.step("recurrence", async (t) => {
    const args = [
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30D45R4/05:67",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30D45R47/05:67",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30D45R/05:67",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30D45RM8/05:67",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30D45RY8/05:67",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30D45RW8/05:67",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30D45RD8/05:67",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-30/05-30RD8/05:67",
    ];
    for (const arg of args) {
      await t.step(arg, () => assertSnapshot(t, parse(arg)));
    }
  });
  await t.step("errors", async (t) => {
    const args = [
      "+3@2023-04-30/23D45 çµ‚äº†æ—¥æ™‚ãŒé–‹å§‹æ—¥æ™‚ã‚ˆã‚Šæ—©ã¾ã£ã¦ã¯ãªã‚‰ãªã„",
      "ä¸æ­£ãªæ—¥æ™‚ã‚’ä¸Žãˆã‚‹ã¨Invalid Dateã«ãªã‚‹+3@2023-04-33/05-23D45",
      "ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹+3@2023-04-13T13:40/05:67D45",
    ];
    for (const arg of args) {
      await t.step(arg, () => assertSnapshot(t, parse(arg)));
    }
  });
});
